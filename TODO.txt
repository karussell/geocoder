# world wide!
    increase number of open files to 100000 http://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/

# schöne werbeseite -> aus bayreuth http://www.feuerpfeil.de/
  www.24plus.de, active-logistics.com
  info@lbs-spediteure.de

setup integration tests! via javascript fetching from live installation?

minor improvements
    neukölln has a boundary but erlangerstraße has nothing associated -> should at least get the name!
        two identical neukölln boundaries with different center!?
    icon for every type like bus_stop
    some boundaries have no center node -> search by name!
        check with birkenstraße leipzig -> 4259951
    how to determine bounding box for boudingIndex before? stored in elasticsearch from JsonFeeder?
    copy is_in into name (and keep name in orig_name) also for cities with no bounding handling!
    how to boost streets of bigger cities more -> assign with the same population?
    instead of population => calculate area and sort by area? => more complete data!
       also include type for sorting! town, city, village, hamlet, locality
    synonyms like nyc
    support somehow names.lang!
    if one term consists only from numbers but more than 3 => assume postcode => do prefix query against address.postcode or include to normal query if not last term

# make it possible to get more suggestions -> more button -> and then? paging?
    put all suggestions via markers directly on the map and popup if selected. already necessary for 'bremen'
# split irgendwasstrasse => irgendwasstraße UND umlaute normalisieren! -> decompound plugin (GPL :()
    erlangerstraße should also suggest "erlanger straße"; Karl-Liebknecht-Straße should suggest itself -> this is ok: "Karl-Liebknecht Straße"
    phonetic analyzer => umlaute and ph/f and more
# cluster results e.g. to reduce suggestions for "Am Mainflecklein"
    we could do a facet over the result and visualize this somehow! or: cluster while indexing!
    name:Am Mainflecklein; osm_0:123; coord_0:1,1; osmid_1:234; coord_1:2,2; ...

## lots of places have no boundary => distance heuristic + clustering via graphhopper
## multi line suggestion -> important to determine the name + associated correct admin_level
    Am Mainflecklein, Bayreuth
    95444, Bayern, Bundesrepublik Deutschland, Europe
    so do suggestions on name but display via 
        street, location=(town,city,village,...), zipcode, country, streetnumber
    hierarchy of boundaries required to find out 'is_in'    
        determine admin_level from is_in just via counter--? and then assign country, city, ...? for a better layout of the suggestions 
    street [no],[zipcode,] [near] city|village [province|county] [country]
        add 'near' if only a guess => is_near vs. is_in?
        allow multiple is_near

release!
########
    see graphhopper TODO.txt for all possible announcements ;)

# feed street numbers via buildings (?)
fix counter clock wise hack in calcArea

if ambiguity is detected for a name => display it beneath the input
  find duplicate streets in Berlin => check zipcode or other different info
    torstraße, bergstraße, mind. 3 Wrangelstraßen
  innovate with ambiguity detection -> click on '?' to get selection
replace nominatim geocoding too! not only suggestions

feed and search index can be different -> important for live situation!

nice: https://github.com/brunob/leaflet.fullscreen
nice title: Instant Routing with GraphHopper. Innovation beyond Google Maps?

fine tuning
  * improve simplify - e.g. skip coordinate only if area increases. decrease geocoder.smallboundary to include calling simplify again!
  * boost streets (e.g. not bus_stop)
  * streetnumbers => 1-3 => 1,2,3 => komma, minus oder semicolon als trennzeichen bei hausnummern http://www.openstreetmap.org/user/okilimu/diary/20423
  
# tune spatial key resolution for boundary simplification! why is time nearly identical??
    key=32: 1m27, simplified to 25%
    key=36: 1m25, simplified to 52%
    key=40: 1m26, simplified to 80%
    key=48: 1m24, simplified to 99.8%
    key=56: 1m24, not simplified!
    info: 48 relations, 152284 ways (53sec), 53823 nodes (15sec)

can we fix this? 
    Cannot index object osmrelation/62485. Error:MapperParsingException[failed to parse [bounds]]; nested: InvalidShapeException[Self-intersection at or near point (13.656701304102977, 50.73115275825291, NaN)];
    Cannot index object osmway/31321783. Error:MapperParsingException[failed to parse [bounds]]; nested: InvalidShapeException[Self-intersection at or near point (12.691212114916365, 50.79287892731631, NaN)]; 
    2013-11-26 08:37:43,084 [main] WARN  graphhopper.geocoder.JsonFeeder - Cannot index object osmway/203816457. Error:MapperParsingException[failed to parse]; nested: JsonParseException[Non-standard token 'NaN': enable JsonParser.Feature.ALLOW_NON_NUMERIC_NUMBERS to allow at [Source: [B@1242875; line: 1, column: 34]];
    jillesvangurp.osm2geojson.OsmPostProcessor$WayManager - second pointer was already assigned. node:1627882298, relId:2198517,Connewitz
    check if landkreis is skipped http://www.openstreetmap.org/browse/relation/62378 vs. stadt http://www.openstreetmap.org/browse/relation/62640   

# create integration test for bavaria
  one entity:    
    bay -> bayern + bayreuth
    nuremberg und Munich und Bavaria
    algäu -> Allgäu    
    Fuerth und Fürt und Fuert
    roter main -> should get some street not the river
    Bahnhofstraße Bayreuth => will be resolved into bindlach
    bayreuth bahnhof -> hollfeld!?!?
    potsdam bahnhof -> Bahnhof, Potsdamer Straße, Michendorf!?
    Postbauer heng
    Lauf Pegnitz 
    Kufsteinerstraße/Alpenweg
    Hof/Töpen
    fuzzy: grevenberg -> gräfenberg
    weiden oberpfalz -> falsche coords in nominatim
    neukirch -> ?? Neuve-Église, Sélestat-Erstein, Niederrhein, Elsass, Frankreich
    kölln vs. köln! -> mit fuzzy geht das
    koeln vs. köln -> see decompound plugin below or CharFilter
    erlangerstraße vs. erlanger straße -> https://github.com/jprante/elasticsearch-analysis-decompound -> GPL!
  two entities
    Bahnhofstraße Bayreuth -> not Bindlach!    
    Hasloh Hagenkampsweg => nothing found although it found hasloh
    does often not work when no comma before zipcodes. e.g.: ABC Strasse 19, 20354 Hamburg
    fuzzy: bayreuth grafenreutherstrasse ->bayreuth gravenreutherstrasse 
    steinbank neudorf/spree -> not "steinbank neudorf
    bayreuth Sportzentrum, Am Sportpark 3 
    bayreuth sportzentrum => pottenstein!?!?
    100 Institute Road, Worcester, MA 01609 and it sent me here 100 Institute Road, Grafton, MA 01536 
    Stauffenbergallee 7A, 01099 Dresden
    Stresemannstr. 36, 10963 Berlin -> if missing number use existing number like 37
    berlin anhalterbhf or berlin anhalterbahnhof
  poi
    dürerhof
    Checkpoint charlie Berlin vs charly
    Jugendherberge/LIMARE
    Bahnhof Bayreuth
    isle of man -> GB
    moto nützel bayreuth -> Motor Nützel, Justus-Liebig-Straße, Jakobshof, Hetzennest, Bayreuth, Regierungsbezirk Oberfranken
Nominatim issues: 
 * rio grande -> fluss vs. stadt!
 * Bahnhofstraße Bayreuth => will be resolved into bindlach
 * finds "steinbank neudorf/spree" but not "steinbank neudorf"
 * Hasloh Hagenkampsweg => nothing found although it found hasloh
 * does often not work when no comma before zipcodes. e.g.: ABC Strasse 19, 20354 Hamburg
 * dyon -> dijon france
 * bayreuth grafenreutherstrasse ->bayreuth gravenreutherstrasse 
 * bauhof bayreuth -> Am Bauhof bayreuth!

* fix/think about "failed to add" messages
* problem if several threads/processes are using SortingWriter -> this should include a random or unique number
   File file = new File(tempDir, "bucket-" + bucketNr + ".gz");   
* include wikipedia somehow http://productforums.google.com/forum/m/#!topic/maps/toaewYdz0kg
   http://wikimapia.org, http://retred.org/, http://www.wikivoyage.org/
* should we de-duplicate? and how?
* street additionally has array of housenumber+locations, and higher_level_population
* integrate into graphhopper enterprise -> /geocoder?input=blup&autocomplete=true&reverse=false
      edge-ngrams and match prefix queries
        http://www.elasticsearch.org/guide/reference/query-dsl/prefix-query/
        http://www.elasticsearch.org/guide/reference/query-dsl/match-query/
        http://www.elasticsearch.org/guide/reference/index-modules/analysis/edgengram-tokenizer/

      via fuzzy search
        http://www.elasticsearch.org/guide/reference/query-dsl/fuzzy-query/
      
      via facets -> ElasticTweetSearch.getQueryChoices -> context dependent autocomplete!
            split the query into “completed” terms and one “to do” term. E.g. if you enter “michael jack”. Then michael is complete (ends with space) and jack should be completed. set the query term of the old query to michael and add the facet.prefix=jack            

Infos
 * http://blog.wheerd.de/2012/03/11/cutting-concave-polygons/
   -> http://hg.wheerd.de/Game/file/tip/src/de/wheerd/game/util/ShapeUtil.java#l623
 * fast and simple point in polygon algo http://stackoverflow.com/a/2922778/194609
 * MapperParsingException[failed to parse [bounds]]; 
    nested: InvalidShapeException[Self-intersection at or near point (48.284235162589326, 10.375858042415862, NaN)]; 
    -> PROBLEM via peucker: when we do douglas peucker then the shape is overlapping!
    -> ogr2ogr has a simplify option that does something similar and also gets rid of self intersections.
    -> or use JTS http://stackoverflow.com/questions/17613561/solr-spatial-search-with-self-intersecting-polygons
    -> not that often. see name = Krumbach -> http://www.openstreetmap.org/browse/relation/444105
    http://www8.cs.umu.se/kurser/TDBAfl/VT06/algorithms/BOOK/BOOK5/NODE195.HTM
        -> instead of peucker via remove, do peucker via adding points and see if that fits the original polygon
        -> intersection detection http://www8.cs.umu.se/kurser/TDBAfl/VT06/algorithms/BOOK/BOOK4/NODE191.HTM
    try Concave Hull, alpha shapes -> http://gis.stackexchange.com/questions/1200/what-are-definition-algorithms-and-practical-solutions-for-concave-hull            
            LGPL https://github.com/openplans/OpenTripPlanner/blob/master/otp-core/src/main/java/org/opensphere/geometry/algorithm/ConcaveHull.java
            BSD http://code.google.com/p/stemptag/source/browse/src/placerefs/gazetteer/ConcaveHullBuilder.java
   => approach 1: concave hull
   approach 2: instead of peucker via remove, do peucker via adding points, only add point if "massive change" of polygon area toward the original area
    see area calculation: http://en.wikipedia.org/wiki/Polygon and http://www.mathopenref.com/coordpolygonarea2.html
    and before adding make a point in polygon test! http://en.wikipedia.org/wiki/Point_in_polygon
    additionally look upwards or downwards between two points if this is inside or outside 
        => has to be the same returned from the "point in polygon" test! otherwise it will result in a self intersecting polygon!
   approach 3: paint border on a grid like format and choose the outer 'pixels' to form the resulting border!
   approach 4: use e.g. points forming a circle and every line then gets a fixed angle-area => now make the circle as small as possible where the outer border should not overlapp the real boundary
   http://www.scribd.com/doc/3124116/A-Simple-FastEffective-Polygon-Reduction-Algorithm 
 * match_phrase_prefix has problems e.g. with 'dr' => 'dresden' is not returned
    or "dresden go" => 'dresden gorbitz' is not returned
 * ngram stuff has problem for dresden b => dresdenerstrasse still matches!?
   http://stackoverflow.com/questions/9421358/filename-search-with-elasticsearch/9432450#9432450